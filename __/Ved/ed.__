beg
  subclass Ed from Ved

  def ed_editline (s) proc
    variable
      prev_l,
      next_l,
      lline,
      lnr = __vlnr (s, '.'),
      line = __vline (s, '.'),
      len = strlen (line);

    ifnot (lnr)
      prev_l = "";
    else
      prev_l = __vline (s, s.ptr[0] - 1);

    if (lnr == s._len)
      next_l = "";
    else
      next_l = s.lines[lnr + 1];

    if ('C' == s._chr)
      {
      Ved.Vundo.set (s, [line], [lnr]);
      line = substr (line, 1, s._index);
      }
    else if ('a' == s._chr && len)
      {
      s._index++;
      s.ptr[1]++;
      }
    else if ('A' == s._chr)
      {
      s._index = len;
      s.ptr[1] = len;
      }

    if (s._index - s._indent > s._maxlen)
      lline = __vgetlinestr (s, line, s._findex + 1);
    else
      lline = __vgetlinestr (s, line, 1);

    if (strlen (lline))
      {
      waddline (s, lline, 0, s.ptr[0]);
      Smg.refresh ();
      }

    if ('C' == s._chr) % add to register? not really usefull
      Ved.Insert.mode (s, &line, lnr, prev_l, next_l;modified);
    else
      Ved.Insert.mode (s, &line, lnr, prev_l, next_l);
  end

end
