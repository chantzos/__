class Xclnt
  import xclient

  let XDIR = Env->TMP_PATH + "/X";
  let WRFIFO = XDIR + "/Svfifo";
  let RDFIFO = XDIR + "/Clfifo";
  let! WRFD = NULL;
  let! RDFD = NULL;
  let MODIFIER = 'a';
  let KEY = "bracketleft";
  let! DESKLEN = 13;
  let CUR_ID = 0;
  let ERR = 0xc8;

  subclass Desk
    __init__
      change_by
        id
        name
      get
        cur
        winds
    end

    def get_cur ()
    end

    def get_winds (desk)
      ifnot (-1 < desk < Xclnt->DESKLEN)
        return NULL;

      XSendKey (Xclnt->MODIFIER, Xclnt->KEY);

      Xclnt.let ("RDFD", open (Xclnt->RDFIFO, O_RDONLY));
      Xclnt.let ("WRFD", open (Xclnt->WRFIFO, O_WRONLY));

      Sock.send_str (Xclnt->WRFD, "getdeskclassnames");
      if (Xclnt->ERR == Sock.get_int (Xclnt->RDFD))
        return NULL;

      Sock.send_int (Xclnt->WRFD, desk);
      return Sock.get_str_ar (Xclnt->RDFD, Xclnt->WRFD);
    end

    def change_by_id (did)
      if (0 == (-1 < did < Xclnt->DESKLEN) || did == Xclnt->CUR_ID)
        return;
    end

    def change_by_name (did)
      if (0 == (-1 < did < Xclnt->DESKLEN) || did == Xclnt->CUR_ID)
        return;
    end
  end
end
